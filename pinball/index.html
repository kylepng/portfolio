<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>3D Pinball for Windows - Space Cadet</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Tahoma, Geneva, Verdana, sans-serif;
      background-color: #000;
      overflow: hidden;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    canvas.emscripten {
      border: 0 none;
      background-color: #000;
      flex: 1;
      width: 100%;
    }

    #status {
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    .controls-bar {
      background: linear-gradient(180deg, #1e3a5f 0%, #0d1a2d 100%);
      color: #fff;
      padding: 6px 10px;
      font-size: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      border-bottom: 1px solid #0a1020;
    }

    .controls-bar kbd {
      background: #333;
      border: 1px solid #555;
      border-radius: 2px;
      padding: 1px 4px;
      font-family: monospace;
      font-size: 9px;
    }

    .controls-bar .label {
      color: #4fc3f7;
      font-weight: bold;
    }

    .controls-bar .tip {
      margin-left: auto;
      color: #888;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div class="controls-bar">
      <span class="label">Controls:</span>
      <span><kbd>Space</kbd> Launch</span>
      <span><kbd>F2</kbd> New Game</span>
      <span><kbd>Z</kbd> Left Flipper</span>
      <span><kbd>/</kbd> Right Flipper</span>
      <span><kbd>X</kbd> / <kbd>.</kbd> Nudge</span>
      <span class="tip">Click game first!</span>
    </div>
    <div id="status">Loading game...</div>
    <div>
      <progress hidden id="progress" max="100" value="0"></progress>
    </div>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" style="display:none" tabindex="0"></canvas>
  </div>

  <script>
    // Mute all audio by intercepting AudioContext
    (function() {
      const OriginalAudioContext = window.AudioContext || window.webkitAudioContext;
      if (OriginalAudioContext) {
        window.AudioContext = window.webkitAudioContext = function() {
          const ctx = new OriginalAudioContext();
          // Create a gain node set to 0 (muted)
          const mutedGain = ctx.createGain();
          mutedGain.gain.value = 0;
          mutedGain.connect(ctx.destination);
          // Override destination to route through muted gain
          Object.defineProperty(ctx, 'destination', {
            get: function() { return mutedGain; }
          });
          return ctx;
        };
      }
    })();

    // Auto-focus canvas when loaded
    window.addEventListener('load', function() {
      setTimeout(function() {
        const canvas = document.getElementById('canvas');
        if (canvas) canvas.focus();
      }, 1500);
    });

    // Click anywhere to focus canvas
    document.addEventListener('click', function() {
      const canvas = document.getElementById('canvas');
      if (canvas && canvas.style.display !== 'none') {
        canvas.focus();
      }
    });
  </script>

  <script>
    var statusElement = document.getElementById("status");
    var progressElement = document.getElementById("progress");

    var Module = {
      preRun: [],
      postRun: [],
      print: function() {
        var e = document.getElementById("output");
        return e && (e.value = ""), function(e) {
          arguments.length > 1 && (e = Array.prototype.slice.call(arguments).join(" ")),
          console.log(e)
        }
      }(),
      printErr: function(e) {
        arguments.length > 1 && (e = Array.prototype.slice.call(arguments).join(" ")),
        console.error(e)
      },
      canvas: function() {
        var e = document.getElementById("canvas");
        return e.addEventListener("webglcontextlost", function(e) {
          alert("WebGL context lost. You will need to reload the page."),
          e.preventDefault()
        }, !1), e
      }(),
      setStatus: function(e) {
        if (Module.setStatus.last || (Module.setStatus.last = {time: Date.now(), text: ""}),
            e !== Module.setStatus.last.text) {
          var t = e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),
              n = Date.now();
          if (!(t && n - Module.setStatus.last.time < 30)) {
            if (Module.setStatus.last.time = n, Module.setStatus.last.text = e, t)
              e = t[1],
              progressElement.value = 100 * parseInt(t[2]),
              progressElement.max = 100 * parseInt(t[4]),
              progressElement.hidden = !1;
            else
              progressElement.value = null,
              progressElement.max = null,
              progressElement.hidden = !0,
              document.getElementById("canvas").style.display = "";
            statusElement.innerHTML = e,
            "" === e ? (statusElement.style.display = "none", progressElement.style.display = "none")
                     : (statusElement.style.display = "", progressElement.style.display = "")
          }
        }
      },
      totalDependencies: 0,
      monitorRunDependencies: function(e) {
        this.totalDependencies = Math.max(this.totalDependencies, e),
        Module.setStatus(e ? "Preparing... (" + (this.totalDependencies - e) + "/" + this.totalDependencies + ")" : "All downloads complete.")
      }
    };

    Module.setStatus("Loading...");
    window.onerror = function() {
      Module.setStatus("Exception thrown, see JavaScript console"),
      Module.setStatus = function(e) {
        e && Module.printErr("[post-exception status] " + e)
      }
    }
  </script>
  <script async src="SpaceCadetPinball.js"></script>
</body>
</html>
